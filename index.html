<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8">
<title>Reventa Profesional Cloud</title>
<meta name="viewport" content="width=device-width, initial-scale=1">

<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js"></script>
<script src="https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>

<style>
body{font-family:Arial;background:#f4f6f9;margin:0;}
header{background:#0f172a;color:white;padding:20px;text-align:center;}
.container{padding:20px;}
.card{background:white;padding:20px;border-radius:10px;margin-bottom:20px;box-shadow:0 2px 8px rgba(0,0,0,0.1);}
input,button,select{padding:8px;margin:5px;}
button{background:#2563eb;color:white;border:none;border-radius:5px;cursor:pointer;}
table{width:100%;border-collapse:collapse;}
th,td{padding:10px;border-bottom:1px solid #ddd;text-align:center;}
th{background:#e5e7eb;}
</style>
</head>

<body>

<header>
<h1>Reventa Profesional Cloud</h1>
</header>

<div class="container">

<div class="card">
<h2>Crear Lote</h2>
<input id="precioCaja" type="number" placeholder="Precio caja">
<input id="envioCaja" type="number" placeholder="Env√≠o">
<button onclick="crearLote()">Crear lote</button>
</div>

<div class="card">
<h2>Seleccionar Lote</h2>
<select id="selectorLote" onchange="mostrarProductos()"></select>
</div>

<div class="card">
<h2>Agregar Producto</h2>
<input id="nombreProducto" placeholder="Nombre producto">
<input id="precioEstimado" type="number" placeholder="Precio estimado venta">
<input id="stockProducto" type="number" placeholder="Stock">
<button onclick="agregarProducto()">Agregar</button>
</div>

<div class="card">
<h2>Productos</h2>
<table>
<thead>
<tr>
<th>Producto</th>
<th>Stock</th>
<th>Coste</th>
<th>Vendidos</th>
<th>Acci√≥n</th>
</tr>
</thead>
<tbody id="tabla"></tbody>
</table>
</div>

</div>

<script type="module">

// üî¥ PEGA AQU√ç TU firebaseConfig
const firebaseConfig = {
  apiKey: "PEGA_AQUI",
  authDomain: "PEGA_AQUI",
  projectId: "PEGA_AQUI",
  storageBucket: "PEGA_AQUI",
  messagingSenderId: "PEGA_AQUI",
  appId: "PEGA_AQUI"
};

import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
import { getFirestore, collection, addDoc, getDocs, doc, updateDoc, deleteDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

const app = initializeApp(firebaseConfig);
const db = getFirestore(app);

let loteActual = null;

// Crear lote
async function crearLote(){

let precio=parseFloat(document.getElementById("precioCaja").value);
let envio=parseFloat(document.getElementById("envioCaja").value)||0;

await addDoc(collection(db,"lotes"),{
inversion:precio+envio
});

cargarLotes();
}

// Cargar lotes
async function cargarLotes(){

let snap=await getDocs(collection(db,"lotes"));
let selector=document.getElementById("selectorLote");
selector.innerHTML="";

snap.forEach(docu=>{
selector.innerHTML+=`<option value="${docu.id}">${docu.id}</option>`;
});

}

async function agregarProducto(){

let nombre=document.getElementById("nombreProducto").value;
let precioEstimado=parseFloat(document.getElementById("precioEstimado").value);
let stock=parseInt(document.getElementById("stockProducto").value);

await addDoc(collection(db,"lotes",loteActual,"productos"),{
nombre,
precioEstimado,
stock,
vendidos:0
});

mostrarProductos();
}

async function mostrarProductos(){

loteActual=document.getElementById("selectorLote").value;

let snap=await getDocs(collection(db,"lotes",loteActual,"productos"));
let tabla=document.getElementById("tabla");
tabla.innerHTML="";

snap.forEach(docu=>{
let p=docu.data();
tabla.innerHTML+=`
<tr>
<td>${p.nombre}</td>
<td>${p.stock}</td>
<td>${p.precioEstimado}</td>
<td>${p.vendidos}</td>
<td>
<button onclick="vender('${docu.id}')">Vender</button>
<button onclick="eliminarSinVenta('${docu.id}')">Eliminar</button>
</td>
</tr>
`;
});

}

window.vender=async function(id){

let precio=parseFloat(prompt("Precio venta"));

let ref=doc(db,"lotes",loteActual,"productos",id);
let snap=await getDocs(collection(db,"lotes",loteActual,"productos"));

await updateDoc(ref,{
vendidos:1
});

mostrarProductos();
}

window.eliminarSinVenta=async function(id){

if(!confirm("Eliminar producto sin vender?")) return;

await deleteDoc(doc(db,"lotes",loteActual,"productos",id));
mostrarProductos();
}

cargarLotes();

</script>

</body>
</html>
